<!DOCTYPE html>

<html>
    <head>
        <style>
            body {
                background-color: black;
                margin: 0px;
                color: white;
            }
        </style>
        <script>
            const a = 1664525;
            const c = 1013904223;
            const m = Math.pow(2, 32);
            
            class CustomRandom {
                static #seed = 0;

                static SetSeed(newSeed) {
                    this.seed = Math.floor(newSeed);
                }

                static Generate(floor, ceil) {
                    this.seed = Math.floor((a * this.seed + c) % m);
                    return (this.seed % (ceil - floor + 1)) + floor;
                }
            }

            window.onload = function() {
                // Get HTML elements.
                const imageURLInput = document.getElementById("imageurlinput");
                const passwordInput = document.getElementById("passwordinput");

                const scrambleButton = document.getElementById("scramblebutton");
                const unscrambleButton = document.getElementById("unscramblebutton");

                const canvas = document.getElementById("imagecanvas");
                const context = canvas.getContext("2d");

                function ScrambleImage(imageURL, password, unscramble) {
                    let testImage = new Image();
                    testImage.crossOrigin = "";
                    testImage.src = imageURL;

                    testImage.onload = async function() {
                        // Resize the canvas to fit the image.
                        canvas.width = testImage.width;
                        canvas.height = testImage.height;

                        // Get the image data.
                        context.drawImage(testImage, 0, 0);
                        let imageData = context.getImageData(0, 0, testImage.width, testImage.height);

                        let pixelCount = testImage.width * testImage.height;

                        // Hash the password.
                        let hashedPassword = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(password));
                        hashedPassword = new Uint32Array(hashedPassword);

                        // Determine loop bounds and increments.
                        let pixelStart, pixelEnd, inc;
                        let roundStart, roundEnd;
                        
                        if (unscramble) {
                            pixelStart = pixelCount - 1;
                            pixelEnd = -1;
                            inc = -1;
                            roundStart = hashedPassword.length - 1;
                            roundEnd = -1;
                        } else {
                            pixelStart = 0;
                            pixelEnd = pixelCount;
                            inc = 1;
                            roundStart = 0;
                            roundEnd = hashedPassword.length;
                        }
                        
                        let randomNumbers = new Uint32Array(pixelCount);
                        
                        for (let i = roundStart; i != roundEnd; i += inc) {
                            CustomRandom.SetSeed(hashedPassword[i]);

                            for (let j = 0; j < randomNumbers.length; j++)
                                randomNumbers[j] = CustomRandom.Generate(0, pixelCount) * 4;
                            
                            // Scramble or unscramble the pixels.
                            for (let j = pixelStart; j != pixelEnd; j += inc) {
                                let jx4 = j * 4;

                                for (let k = 0; k < 4; k++) {
                                    let tempColor = imageData.data[jx4 + k];
                                    imageData.data[jx4 + k] = imageData.data[randomNumbers[j] + k];
                                    imageData.data[randomNumbers[j] + k] = tempColor;
                                }
                            }
                        }

                        // Put the result back on the canvas.
                        context.putImageData(imageData, 0, 0);
                    }
                }

                scrambleButton.onclick = function() {
                    ScrambleImage(imageURLInput.value, passwordInput.value, false);
                }

                unscrambleButton.onclick = function() {
                    ScrambleImage(imageURLInput.value, passwordInput.value, true);
                }
            }
        </script>
    </head>
    <body>
        <input type="text" id="imageurlinput" name="imageurlinput">
        <label for="imageurlinput">Image URL</label>
        <br>
        <input type="password" id="passwordinput" name="passwordinput">
        <label for="passwordinput">Password</label>
        <br>

        <button id="scramblebutton">Scramble</button>
        <button id="unscramblebutton">Unscramble</button>
        <br>

        <canvas id="imagecanvas"></canvas>
    </body>
</html>
